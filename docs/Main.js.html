<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Punto de entrada del juego.
 * Controla el cambio de escenas, inicializa al jugador
 * y coordina las rondas de batalla y la pantalla final.
 */

import { showScene, mostrarStats, reloadAnimation } from './Utils/utils.js';
import { jugador } from './Utils/constants.js';
import { selected, showCatalog, paintInventory } from './Modules/Mercado.js';
import { showBestiario, getRandomEnemy } from './Modules/Bestiario.js';
import { combat, paintBattle, playerContainer, enemyContainer } from './Modules/Batalla.js';
import { showPlayerStatus, getPlayerStatus } from './Modules/Ranking.js';


// -------- Selectores de escenas y botones ------------------------------------
const goToScene2 = document.getElementById('goToScene2'); /* Escena 2: mercado */
const goToScene3 = document.getElementById('goToScene3'); /* Escena 3: jugador con inventario actualizado */
const goToScene4 = document.getElementById('goToScene4'); /* Escena 4: enemigos*/
const goToScene5 = document.getElementById('goToScene5'); /* Escena 5: batalla */
const goToScene6 = document.getElementById('goToScene6'); /* Escena 6: ranking */

const nextBattle = document.getElementById('nextBattle'); /* Botón para la siguiente batalla*/
const playAgain = document.getElementById('playAgain');   /* Botón para reiniciar el juego */


/* -------- Estado inicial -----------------------------------------------------*/
showScene('scene-1');
mostrarStats(jugador, 1);

const MAX_ROUND = 3; // Número máximo de batalla
let round = 0;       // Ronda de batalla actual. La declaramos a nivel global porque la necesitan tanto el listener del cambio
                     // de escena como el listener de avance de ronda. 


/* -------- Navegación entre escenas ------------------------------------------*/

// Escena 1 -> Escena 2 (mercado)
goToScene2.addEventListener('click', () => {
  showScene('scene-2');
  showCatalog();
});

// Escena 2 -> Escena 3 (jugador con inventario actualizado)
goToScene3.addEventListener('click', () => {
  // Generamos el inventario del jugador a partir de los productos seleccionados. 
  // Lo que usábamos antes (jugador.inventario = [...selected]) no clonaba los objetos, los copiaba manteniendo la referencia original.
  selected.forEach(p => jugador.aniadirProducto(p));
  
  showScene('scene-3');
  jugador.vida = jugador.vidaInicial; //Recalculamos la vida inicial una vez lleno el inventario.
  mostrarStats(jugador, 3);
  paintInventory(jugador.inventario); // SOLO ES NECESARIO PINTARLO UNA VEZ
});

// Escena 3 -> Escena 4 (bestiario de enemigos)
goToScene4.addEventListener('click', () => {
  showScene('scene-4');
  showBestiario();
});

// Escena 4 -> Escena 5 (batalla, primera ronda)
goToScene5.addEventListener('click', () => {
  showScene('scene-5');
  startNextRound();   // La primera ronda se ejecuta cuando la escena carga, y es dentro cuando la variable 'round' toma valor.
});

// Botón "Siguiente batalla" (siguientes rondas)
nextBattle.addEventListener('click', () => {
  startNextRound(); 
});

// Escena 5 -> Escena 6 (ranking)
goToScene6.addEventListener('click', () => {
  showScene('scene-6');
  showPlayerStatus(jugador, getPlayerStatus(jugador));

  playAgain.addEventListener('click', () => {
    location.reload();
  });
});


/* -------- Lógica de rondas de batalla ---------------------------------------*/
// Esta función va aquí porque maneja escenas, no encaja con la lógica de batalla per se.
/**
 * Ejecuta una ronda de batalla:
 * - comprueba si se puede luchar,
 * - enfrenta al jugador con un enemigo aleatorio,
 * - actualiza animaciones y botones según el estado.
 */
function startNextRound() {
  // Habilitamos el botón de finalizar partida si no se puede hacer la ronda
  if (round >= MAX_ROUND || jugador.vida &lt;= 0) { 
    goToScene6.classList.remove('hidden');
    nextBattle.classList.add('hidden');
    return;
  }
  round += 1; // Si hacer una ronda más es posible, se ejecuta.

  const enemigo = getRandomEnemy();
  paintBattle(jugador, enemigo);
  combat(jugador, enemigo);  
  // Recargamos las animaciones conforme se ejecutan, para tenerlas listas para el siguiente combate.
  reloadAnimation(playerContainer, 'enter');
  reloadAnimation(enemyContainer, 'enter');

  // Tras el combate, reevaluamos si las condiciones han cambiado, y por tanto debe hacerlo el botón disponible (antes de terminar la ejecución de la función).
  if (round >= MAX_ROUND || jugador.vida &lt;= 0) {
    goToScene6.classList.remove('hidden');
    nextBattle.classList.add('hidden');
    return;
  }
}

/* Testing */
// jugador.inventario = [new Producto("Cuchilla de Plasma", 900, "Rara", "Arma", { ataque: 25 }, "./../img/knife.png"),
//     new Producto("Casco Antirradiación", 600, "Infrecuente", "Armadura", { defensa: 20 }, "./../img/helmet.png"),
//     new Producto("Pistola Iónica de Emergencia", 550, "Común", "Arma", { ataque: 12 }, "./../img/pistol.png"),
//     new Producto("Inyector de Adrenalina Sintética", 420, "Infrecuente", "Consumible", { vida: 25 }, "./../img/injector.png"),
//     new Producto("Lanza Fotónica", 1500, "Legendaria", "Arma", { ataque: 55 }, "./../img/lance.png"),
//     new Producto("Suero Estabilizador de Oxígeno", 320, "Común", "Consumible", { vida: 18 }, "./../img/container.png")]



</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Enemigo.html">Enemigo</a></li><li><a href="Jefe.html">Jefe</a></li><li><a href="Jugador.html">Jugador</a></li><li><a href="Producto.html">Producto</a></li></ul><h3>Global</h3><ul><li><a href="global.html#EUR">EUR</a></li><li><a href="global.html#aplicarDescuentoRareza">aplicarDescuentoRareza</a></li><li><a href="global.html#bestiario">bestiario</a></li><li><a href="global.html#buscarProducto">buscarProducto</a></li><li><a href="global.html#buyProduct">buyProduct</a></li><li><a href="global.html#combat">combat</a></li><li><a href="global.html#filtrarPorRareza">filtrarPorRareza</a></li><li><a href="global.html#getPlayerStatus">getPlayerStatus</a></li><li><a href="global.html#getRandomEnemy">getRandomEnemy</a></li><li><a href="global.html#groupBy">groupBy</a></li><li><a href="global.html#jugador">jugador</a></li><li><a href="global.html#mostrarProducto">mostrarProducto</a></li><li><a href="global.html#mostrarStats">mostrarStats</a></li><li><a href="global.html#paintBattle">paintBattle</a></li><li><a href="global.html#paintInventory">paintInventory</a></li><li><a href="global.html#productos">productos</a></li><li><a href="global.html#randomiseDiscount">randomiseDiscount</a></li><li><a href="global.html#reloadAnimation">reloadAnimation</a></li><li><a href="global.html#showBestiario">showBestiario</a></li><li><a href="global.html#showCatalog">showCatalog</a></li><li><a href="global.html#showPlayerStatus">showPlayerStatus</a></li><li><a href="global.html#showScene">showScene</a></li><li><a href="global.html#showWinner">showWinner</a></li><li><a href="global.html#startNextRound">startNextRound</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Dec 03 2025 20:29:17 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
